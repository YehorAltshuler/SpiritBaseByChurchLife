---
import Layout from '../../layouts/Layout.astro';
import type { Post } from '../../types'; // Type-only import for verbatimModuleSyntax
// Импорт данных (фильтр по категории; в JSON все посты — Revelation)
import rawPosts from '../../data/posts.json' assert { type: 'json' };
const posts: Post[] = rawPosts as Post[]; // Type assertion to match Post[] (JSON infers media?: string | null); прямой порядок из JSON без реверса
---
<Layout title="Читая книгу Откровение — SpiritBase">
  <h1 class="text-3xl font-bold mb-8">Читая книгу Откровение</h1>
  <ul class="space-y-4 mb-8">
    {posts.map(post => {
      // Consistent slug generation (match [slug].astro)
      const slug = post.title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
      const date = new Date(post.timestamp * 1000).toLocaleDateString('ru-RU');
      return (
        <li class="bg-white p-6 rounded-lg shadow">
          <a href={`/posts/${slug}`} class="block hover:bg-gray-50 p-4 rounded">
            <h2 class="text-xl font-semibold">{post.title}</h2>
            <p class="text-gray-600 mt-2 line-clamp-3">{post.text.substring(0, 200)}...</p>
            <time class="text-sm text-gray-500">{date}</time>
            {post.media && (
              <img 
                src={post.media} 
                alt={post.title} 
                class="mt-2 w-full h-32 md:h-48 lg:h-56 object-contain rounded" 
              />
            )}
          </a>
        </li>
      );
    })}
  </ul>
  <a href="/" class="block mt-8 text-blue-500 hover:underline">← На главную</a>
</Layout>
<style>
  .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
</style>